<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Pux</title><link rel="icon" type="image/x-icon" href="../../favicon.ico"><link rel="stylesheet" href="../../css"><link rel="stylesheet" type="text/css" href="../../atom-one-dark.css"><style></style></head><body><div id="app"><div><style>body { margin: 0.0px 0.0px 0.0px 0.0px ; padding: 0.0px 0.0px 0.0px 0.0px ; background-color: hsl(0.0, 0.0%, 99.22%); font-size: 15.0px; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; line-height: 165.0%; color: hsl(220.0, 6.47%, 27.25%) }
.strong { font-weight: bolder }
blockquote { background-color: hsl(0.0, 0.0%, 98.04%); overflow: auto; margin: 0.0px 0.0px 1.5em 0.0px ; width: 100.0% }
blockquote p { margin: 0.0em 0.0px 0.0px 0.0px ; border-left: solid 4.0px hsl(0.0, 0.0%, 86.27%) ; padding: 1.0em 0.0px 1.0em 24.0px  }
blockquote h4 { margin: 1.0em 0.0px 0.0px 0.0px ; text-align: right }
blockquote h4:nth-child(1) { display: inline-block; padding: 1.0em 24.0px 1.0em 0.0px ; border-right: solid 4.0px hsl(0.0, 0.0%, 86.27%) ; float: right; text-align: right }
blockquote h4:nth-child(2) { border-left: solid 4.0px hsl(0.0, 0.0%, 86.27%) ; padding: 1.0em 0.0px 1.0em 24.0px ; display: inline-block; float: left }
hr { background-color: hsl(0.0, 0.0%, 86.27%); height: 1.0px; border: solid 0.0px hsl(0.0, 0.0%, 86.27%)  }
h1, h2, h3, h4 { line-height: 140.0% }
h1 { font-size: 28.0px; margin: 0.0px 0.0px 1.0em 0.0px  }
h2 { font-size: 21.0px; margin: 1.6em 0.0px 0.7em 0.0px  }
h3 { font-size: 17.0px; margin: 1.8em 0.0px 0.7em 0.0px  }
h4 { font-size: 17.0px; margin: 2.0em 0.0px 0.7em 0.0px  }
h4 code { font-size: 21.0px }
ul { padding: 0.0px 0.0px 0.0px 24.0px  }
ol { padding: 0.0px 0.0px 0.0px 24.0px  }
a { color: hsl(240.69, 55.41%, 69.22%); text-decoration: none }
a:hover { color: hsl(158.02, 56.22%, 54.31%); text-decoration: none }
li code { height: 17.0px; line-height: 17.0px; padding: 0.0px 4.0px 0.0px 4.0px  }
p code { padding: 0.0px 4.0px 0.0px 4.0px  }
code { display: inline-block; border-radius: 2.0px 2.0px 2.0px 2.0px ; line-height: 1.6em; font-size: 14.0px; max-width: 720.0px; background-color: hsl(0.0, 0.0%, 96.08%) }
pre code { display: block; background-color: hsl(306.67, 9.89%, 17.84%); color: hsl(312.0, 6.17%, 84.12%); overflow: auto; padding: 12.0px 12.0px 12.0px 12.0px  }
p { margin: 0.0px 0.0px 1.0em 0.0px ; max-width: 720.0px }
.main { position: absolute; left: 248.0px; right: 0.0px; top: 0.0px; bottom: 0.0px; overflow: auto }
.main .inner { padding: 48.0px 48.0px 16.0px 60.0px  }
.main h1 { line-height: 100.0%; margin-top: 0.0px }
.main li { font-size: 15.0px; margin: 0.3em 0.0px 0.3em 0.0px ; list-style-type: none }
.main li:before { font-size: 11.0px; margin-right: 6.0px; vertical-align: top }
.main ol { counter-reset: item }
.main ol li:before { color: hsl(220.0, 6.47%, 47.25%); content: counter(item) ". "; counter-increment: item }
.main ul li:before { color: hsl(220.0, 6.47%, 87.25%); content: "★" }
.homepage .main ul { font-size: 17.0px }
@media screen and (max-width: 720.0px) { .main { position: relative; right: 0.0px; top: 0.0px; left: 0.0px }
.main .inner { padding: 48.0px 36.0px 16.0px 36.0px  }
 }
</style><div class="guidepage"><style>.sidebar { background-color: hsl(220.0, 13.04%, 18.04%); position: absolute; left: 0.0px; top: 0.0px; bottom: 0.0px; width: 248.0px }
.sidebar h2 { letter-spacing: 1.0px; margin: 0.0px 0.0px 32.0px 0.0px ; padding-left: 15.0px; line-height: 100.0%; text-transform: uppercase }
.sidebar h2 a { color: hsl(0.0, 0.0%, 96.08%) }
.sidebar li a { border-left: solid 3.0px hsl(220.0, 13.04%, 18.04%) ; padding-left: 12.0px; color: hsl(0.0, 0.0%, 96.08%); font-weight: lighter }
.sidebar a:hover { color: hsl(157.99, 64.65%, 57.84%) }
.sidebar .selected { border-left: solid 3.0px hsl(157.99, 64.65%, 57.84%)  }
.sidebar .inner { margin-left: 24.0px; padding: 52.0px 16.0px 16.0px 16.0px  }
.sidebar ul { list-style-type: none; margin-top: 0.0px; padding-left: 0.0px }
.sidebar ul ul li a { padding-left: 24.0px }
@media screen and (max-width: 720.0px) { .sidebar { position: relative; top: 0.0px; width: 100.0% }
 }
</style><nav class="sidebar"><div class="inner"><h2><a href="/">Pux</a></h2><ul><li></li><li><a href="/">Introduction</a></li><li></li><li><a href="/docs/architecture">Architecture</a></li><li></li><li><a href="/docs/events">Events</a></li><li></li><li><a href="/docs/markup">Markup</a></li><li></li><li><a href="/docs/rendering">Rendering</a></li><li></li><li><a href="/docs/components">Components</a></li><li></li><li><a href="/docs/forms">Forms</a></li><li></li><li><a class="selected" href="/docs/routing">Routing</a></li><li></li><li><a href="/docs/css">CSS</a></li><li></li><li><a href="/docs/react-interop">React Interop</a></li></ul><ul><li></li><li><a href="https://pursuit.purescript.org/packages/purescript-pux">API Reference</a></li><li></li><li><a href="https://github.com/alexmingoia/purescript-pux/tree/master/examples/">Examples</a></li><li></li><li><a href="https://github.com/alexmingoia/pux-devtool">Devtool Extension</a></li></ul><ul><li></li><li><a href="https://github.com/alexmingoia/purescript-pux/">GitHub</a></li><li></li><li><a href="https://gitter.im/alexmingoia/purescript-pux">Chat (Gitter)</a></li></ul><ul><li></li><li><a href="/docs/learn-purescript">Learn PureScript</a></li></ul></div></nav><div class="main"><div class="inner"><h1 id="Routing">Routing</h1><p>In Pux, routing is a set of applicatives for matching URLs to data types, along
with a signal for location changes. These are provided by <code>Pux.Router</code>.</p><p>URL changes are mapped to an event. A data type for routes is used
to contain the matched URL along with parameter and query data.</p><pre><code>data Event = PageView Route | Navigate String DOMEvent

data Route = Home | Users String | User Int | NotFound</code></pre><p>We also need a function that constructs a route event from a url, which we
build using routing applicatives and pass to <code>router</code> to return the
matched route:</p><pre><code>match :: String -&gt; Event
match url = PageView $ fromMaybe NotFound $ router url $
  Home &lt;$ end
  &lt;|&gt;
  Users &lt;$&gt; (lit &quot;users&quot; *&gt; param &quot;sortBy&quot;) &lt;* end
  &lt;|&gt;
  Users &quot;name&quot; &lt;$ (lit &quot;users&quot;) &lt;* end
  &lt;|&gt;
  User &lt;$&gt; (lit &quot;users&quot; *&gt; int) &lt;* end</code></pre><blockquote><p>Learn applicative basics in
<a href="http://adit.io/posts/2013-04-17-functors,_applicatives,_and_monads_in_pictures.html#monads">Functors, Applicatives, and Monads in Pictures</a>.</p></blockquote><p><code>Pux.Router</code> provides applicatives <code>lit</code>, <code>str</code>, <code>num</code>, <code>int</code>, <code>bool</code>, <code>param</code>,
<code>params</code>, <code>any</code>, and <code>end</code> for mapping url parts to route values.</p><p>As you can see above, <code>lit</code> matches a literal string, and its value is ignored.
<code>int</code> matches the second part of <code>/users/123</code> to the integer value of <code>User</code>.
<code>end</code> matches the end of the URL. <code>param</code> matches a query parameter, in our case
&quot;sortBy&quot;. Queries are a bit tricky as they are optional. Therefore <code>end</code> also
matches if there is a query present. This means the order of our <code>Users</code> rules
is essential. If we had the <code>param</code> less version first, the one with <code>param</code>
would never be tried!</p><p>Now that we have a function for making a route from a url, we can map it over
the url signal provided by
<a href="https://pursuit.purescript.org/packages/purescript-pux/9.0.0/docs/Pux.DOM.History#v:sampleURL"><code>sampleURL</code></a>
takes a window history object from purescript-dom and returns a signal of the
URL which is updated whenever the <code>popstate</code> event occurs:</p><pre><code>main = do
  urlSignal &lt;- sampleURL =&lt;&lt; window
  let routeSignal = urlSignal ~&gt; match

  app &lt;- start
    { initialState: { currentRoute: Home }
    , view
    , foldp
    , inputs: [routeSignal]
    }</code></pre><p>Every time the location changes and the <code>PageView</code> event occurs, we can update
our state with the current route, which includes any captured path or query
parameters. <code>Navigate</code> is used to change the location in response to the user
clicking a link, using the HTML5 History methods provided by purescript-dom.</p><pre><code>foldp :: ∀ fx. Event -&gt; State -&gt; EffModel State Event (history :: HISTORY, dom :: DOM | fx)
foldp (PageView route) st =
  noEffects $ st { currentRoute = route }
foldp (Navigate url ev) st =
  onlyEffects st [ liftEff do
                     preventDefault ev
                     h &lt;- history =&lt;&lt; window
                     pushState (toForeign {}) (DocumentTitle &quot;&quot;) (URL url) h
                     pure $ Just $ PageView (match url)
                 ]</code></pre><p>Finally, we might want to create links to our routes and show different views
for them. We can use purescript-dom to push a new URL into HTML5 History and
generate a <code>Navigate</code> event.</p><pre><code>view :: State -&gt; Html Event
view state =
  div do
    navigation
    page state.currentRoute

page                :: Route -&gt; Html Event
page Home           = h1 $ text &quot;Home&quot;
page (Users sortBy) = h1 $ text (&quot;Users sorted by:&quot; &lt;&gt; sortBy)
page (User id)      = h1 $ text (&quot;User: &quot; &lt;&gt; show id)
page NotFound       = h1 $ text &quot;Not Found&quot;

navigation :: Html Event
navigation =
  nav do
    ul
      li $ a ! href &quot;/&quot; #! onClick (Navigate &quot;/&quot;) $ text &quot;Home&quot;
      li $ a ! href &quot;/users&quot; #! onClick (Navigate &quot;/users&quot;) $ text &quot;Users&quot;
      li $ a ! href &quot;/users?sortBy=age&quot; #! onClick (Navigate &quot;/users?sortBy=age&quot;) $ text &quot;Users sorted by age.&quot;
      li $ a ! href &quot;/users/123&quot; #! onClick (Navigate &quot;/users/123&quot;) $ text &quot;User 123&quot;
      li $ a ! href &quot;/foobar&quot; #! onClick (Navigate &quot;/foobar&quot;) $ text &quot;Not found&quot;</code></pre><blockquote><h4 id="Next_CSS">Next: <a href="/docs/css">CSS</a></h4><h4 id="Previous_Forms">Previous: <a href="/docs/forms">Forms</a></h4></blockquote></div></div></div></div></div><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>